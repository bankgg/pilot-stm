<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PILOT MEMORY TEST EXAMPLE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- BOOTSTRAP CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- JQUERY -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- BOOTSTRAP JS -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>

  <style>
    /* FORCE ALL TEXT ON THE PAGE TO BE UPPERCASE */
    body {
      text-transform: uppercase;
    }
    .page-section {
      display: none;
    }
    .active-section {
      display: block;
    }
    .timer-container {
      display: none; /* Toggled by SHOW/HIDE TIMER button */
      margin-top: 1rem;
    }
    .timer-display {
      font-weight: bold;
      font-size: 1.5rem;
      width: 80px;
      text-align: center;
    }
  </style>
</head>

<body class="bg-light">
<div class="container py-4">
  <h1 class="mb-4">PILOT SHORT-TERM MEMORY TEST</h1>

  <div class="mb-3">
    <!-- NAV BUTTONS TO SWITCH SUB-PAGES + REGENERATE + TOGGLE TIMER -->
    <button class="btn btn-primary" id="showPassageBtn">PASSAGE</button>
    <button class="btn btn-primary" id="showQuestionsBtn">QUESTIONS</button>
    <button class="btn btn-primary" id="showAnswersBtn">ANSWERS</button>
    <button class="btn btn-success" id="regenerateBtn">REGENERATE TEST</button>
    <button class="btn btn-warning" id="toggleTimerBtn">SHOW/HIDE TIMER</button>
  </div>

  <!-- TIMER SECTION -->
  <div class="timer-container bg-white p-3 border rounded">
    <div class="d-flex align-items-center">
      <div class="me-3">TIMER:</div>
      <div class="timer-display me-3" id="timerDisplay">03:00</div>
      <button class="btn btn-danger" id="toggleStartStopBtn">START TIMER</button>
    </div>
  </div>

  <!-- PASSAGE SECTION -->
  <div class="page-section active-section" id="passageSection">
    <!-- Content generated dynamically by JavaScript -->
  </div>

  <!-- QUESTIONS SECTION -->
  <div class="page-section" id="questionsSection">
    <!-- Questions generated by JavaScript -->
  </div>

  <!-- ANSWERS SECTION -->
  <div class="page-section" id="answersSection">
    <!-- Answers generated by JavaScript -->
  </div>
</div>

<script>
/* 
  UPDATED RANDOM FLIGHT DATA & QUESTIONS LOGIC
  THAT SATISFIES:
  1) FLIGHT LEVELS: FL250 → FL410 (STEP 10)
  2) 30+ AIRCRAFT REGISTRATIONS
  3) FLIGHT NUMBER = CARRIER + 3–4 DIGITS
  4) 30+ CITIES
  5) RUNWAY 01 → 36
  6) 3 OR 4 TOTAL LEGS
*/

// 1) FLIGHT LEVELS
const flightLevels = [
  "FL 250","FL 260","FL 270","FL 280","FL 290","FL 300",
  "FL 310","FL 320","FL 330","FL 340","FL 350","FL 360",
  "FL 370","FL 380","FL 390","FL 400","FL 410"
];

// 2) AIRCRAFT REGISTRATIONS (30+)
const registrations = [
  "HS-TLK","HS-XYZ","VH-OJQ","N123AB","D-ABCD","G-BAJV","F-GHJK",
  "9V-SKP","B-16703","JA8999","9M-MRD","ZK-OKF","OE-LAX","CX-BKT",
  "A4O-BC","SP-LKA","TC-JFE","PK-GII","VT-ESP","A6-EDZ","EC-LPQ",
  "I-BIXP","PR-GTG","PP-VRA","S2-ADF","4R-ALK","SU-GCC","JA734A",
  "B-2956","HL-7615","PT-MVA","YL-LCA","T7-ABC","VQ-BSK"
];

// 3) FLIGHT NUMBER = RANDOM CARRIER + 3-4 DIGITS
const carriers = [
  "TG", "QF", "CA", "BA", "AF", "LH", "EK", "SQ", "CX", "UA",
  "DL", "JL", "GA", "MH", "NZ", "AK", "EY", "QR", "KL", "IB",
  "AZ", "SU", "AA", "AC", "AI"
];
function randomFlightNumber() {
  const carrier = carriers[Math.floor(Math.random() * carriers.length)];
  const length = randInt(3,4);
  let digits = "";
  for (let i=0; i<length; i++){
    digits += randInt(0,9);
  }
  return carrier + " " + digits;
}

// 4) 30+ CITIES
const cities = [
  "HONG KONG","SINGAPORE","SYDNEY","FRANKFURT","DUBAI","BANGKOK",
  "ATHENS","TOKYO","NEW DELHI","ROME","JAKARTA","PARIS","LONDON",
  "LOS ANGELES","NEW YORK","AUCKLAND","SHANGHAI","SEOUL","BEIJING",
  "TORONTO","SAN FRANCISCO","CHICAGO","HANOI","KUALA LUMPUR","MANILA",
  "AMSTERDAM","ZURICH","MUMBAI","CAIRO","RIO DE JANEIRO","JOHANNESBURG",
  "ISTANBUL","DOHA","OSAKA","DENPASAR","MOSCOW"
];

// 5) RUNWAY: “01” → “36”
const runwayNumbers = Array.from({length:36}, (_, i) => (i+1).toString().padStart(2,"0"));

// MISC ARRAYS
const aircraftTypes = [
  "AIRBUS 330-300","AIRBUS 340-300","AIRBUS 300-600","AIRBUS 380",
  "BOEING 747-400","BOEING 777-300","BOEING 787-9","AIRBUS A350-900"
];
const altitudeIntercepts = [2500,3000,3500,4000,4500,5000,5500,6000,6500,7000,7500,8000];
const headings = [100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350];

// --- RANDOM HELPERS ---
function randElem(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}
function randInt(min, max) {
  return Math.floor(Math.random()*(max-min+1)) + min;
}
function randomFlightTime() {
  const hrs = randInt(1,7);
  const mins = randInt(0,59).toString().padStart(2,"0");
  return `${hrs}:${mins}`;
}

// Generate flight data with 3 or 4 legs
function generateTestData() {
  // Number of legs: 3 or 4
  const numLegs = randInt(3,4);
  
  // We need (numLegs+1) distinct cities
  // e.g. if 3 legs => route has 4 cities total: departure, stop1, stop2, final
  // if 4 legs => route has 5 cities total: departure, s1, s2, s3, final
  const totalCitiesNeeded = numLegs + 1;
  
  const routeSet = new Set();
  while (routeSet.size < totalCitiesNeeded) {
    routeSet.add(randElem(cities));
  }
  const routeCities = [...routeSet]; // e.g. [dep, st1, st2, (st3?), final]

  // We’ll generate flight times for each leg
  const times = [];
  for (let i=0; i<numLegs; i++) {
    times.push(randomFlightTime());
  }

  return {
    flightNumber: randomFlightNumber(),
    registration: randElem(registrations),
    aircraftType: randElem(aircraftTypes),
    routeCities, // array
    times,       // array
    numLegs,
    firstClass: randInt(5,40),
    businessClass: randInt(20,200),
    economy: randInt(100,500),
    crew: randInt(8,18),
    runwayDep: randElem(runwayNumbers),
    runwayArr: randElem(runwayNumbers), // Not always used in text
    flightLevel: randElem(flightLevels),
    interceptAltitude: randElem(altitudeIntercepts),
    heading: randElem(headings)
  };
}

// Some random sentence variations to add flavor
const routeSentenceOptions = [
  "BETWEEN ROUTE, THIS FLIGHT WILL MAKE STOPOVERS FOR CHANGING PASSENGERS, CREWS AND REFUELING.",
  "DURING THE JOURNEY, THE FLIGHT WILL STOP FOR PASSENGER TRANSFERS, CREW ROTATION, AND REFUELING.",
  "ALONG THE ROUTE, THIS FLIGHT WILL HAVE STOPOVERS FOR EXCHANGING PASSENGERS, SWITCHING CREWS, AND TAKING FUEL."
];
const departurePhraseOptions = [
  "FOR DEPARTURE FROM",
  "UPON DEPARTING FROM",
  "WHEN TAKING OFF AT"
];
const climbPhraseOptions = [
  "THEY ARE CLEARED TO CLIMB AND MAINTAIN",
  "THE FLIGHT IS CLEARED TO PROCEED TO FINAL CRUISE AT",
  "FOR CLIMB OUT, THEY ARE CLEARED TO MAINTAIN"
];

// Build the text passage
function buildPassage(data) {
  const routeSent = randElem(routeSentenceOptions);
  const depPhrase = randElem(departurePhraseOptions);
  const climbPhrase = randElem(climbPhraseOptions);
  
  const allCities = data.routeCities;
  // e.g. for 3 legs, [dep, stop1, stop2, final]
  // for 4 legs, [dep, stop1, stop2, stop3, final]
  const stops = allCities.slice(1, allCities.length-1); // excludes dep & final
  const departure = allCities[0];
  const finalCity = allCities[allCities.length-1];
  
  // Build a line about each leg’s flight time
  // "FROM X TO Y IS T HOURS," repeated
  let timeDescription = "";
  for (let i=0; i<data.numLegs; i++){
    const legStart = allCities[i];
    const legEnd = allCities[i+1];
    const t = data.times[i];
    timeDescription += `FROM ${legStart} TO ${legEnd} IS ${t} HOURS, `;
  }
  // Trim trailing comma
  timeDescription = timeDescription.slice(0,-2);

  // The crew changes at the last intermediate stop = second-to-last city in the route:
  // allCities.length - 2
  const crewChangeCity = allCities[allCities.length - 2];

  // Build final passage text
  return `
    <h2>MEMORY - 3 MINUTES</h2>
    <p>
      THIS IS FLIGHT ${data.flightNumber} REGISTRATION NUMBER ${data.registration}. 
      TYPE OF THE AIRCRAFT IS ${data.aircraftType}, FROM ${departure} TO ${finalCity}. 
      ${routeSent} THEY ARE ${stops.join(", ")}. 
      ${timeDescription}. 
      THEY ARE ${data.firstClass} PASSENGERS IN FIRST CLASS, ${data.businessClass} IN BUSINESS CLASS 
      AND ${data.economy} PASSENGERS IN ECONOMY. 
      ON THE CABIN ${data.crew} AIRCREWS ARE WORKING UNTIL ${crewChangeCity}, THEN IT WILL CHANGE ALL AIRCREWS THERE. 
      ${depPhrase} ${departure} THE PILOTS USED RUNWAY ${data.runwayDep} FOR TAKE OFF. 
      WHEN REACHING ${data.interceptAltitude} FEET, THEY ARE VECTORED TO TURN RIGHT HEADING ${data.heading} 
      FOR INTERCEPT THE AIRWAY AND THEY ARE CLEARED FOR CLIMBING TO MAINTAIN ${data.flightLevel}. 
      ${climbPhrase} ${data.flightLevel} FOR FINAL LEVEL.
    </p>
  `;
}

// --- QUESTION POOL ---
const questionPool = [
  {
    text: "WHAT IS THE FLIGHT NUMBER?",
    answer: d => d.flightNumber
  },
  {
    text: "WHAT IS THE REGISTRATION NUMBER?",
    answer: d => d.registration
  },
  {
    text: "WHAT IS THE TYPE OF AIRCRAFT?",
    answer: d => d.aircraftType
  },
  {
    text: "HOW MANY CABIN CREWS ARE ON BOARD?",
    answer: d => d.crew
  },
  {
    text: "WHERE DID THE FLIGHT DEPART FROM?",
    answer: d => d.routeCities[0]
  },
  {
    text: "WHAT IS THE FINAL DESTINATION?",
    answer: d => d.routeCities[d.routeCities.length-1]
  },
  {
    text: "HOW MANY PASSENGERS IN FIRST CLASS?",
    answer: d => d.firstClass
  },
  {
    text: "HOW MANY PASSENGERS IN BUSINESS CLASS?",
    answer: d => d.businessClass
  },
  {
    text: "HOW MANY PASSENGERS IN ECONOMY?",
    answer: d => d.economy
  },
  {
    text: "NAME ALL THE INTERMEDIATE STOPOVERS IN ORDER.",
    answer: d => d.routeCities.slice(1, d.routeCities.length-1).join(", ")
  },
  {
    text: "WHERE DID THE AIRCREW CHANGE OCCUR?",
    answer: d => d.routeCities[d.routeCities.length-2]
  },
  {
    text: "WHAT RUNWAY DID THEY USE FOR TAKEOFF?",
    answer: d => d.runwayDep
  },
  {
    text: "HOW HIGH WERE THEY WHEN VECTORED TO TURN RIGHT?",
    answer: d => `${d.interceptAltitude} FEET`
  },
  {
    text: "WHAT HEADING WERE THEY GIVEN TO INTERCEPT THE AIRWAY?",
    answer: d => `${d.heading}`
  },
  {
    text: "WHAT IS THE FINAL CRUISE LEVEL?",
    answer: d => d.flightLevel
  },
  {
    text: "HOW MANY TOTAL FLIGHT LEGS DOES THIS TRIP HAVE?",
    answer: d => d.numLegs
  },
  {
    text: "HOW LONG IS THE FIRST LEG?",
    answer: d => `${d.times[0]} HOURS`
  },
  {
    text: "HOW LONG IS THE FINAL LEG?",
    answer: d => `${d.times[d.numLegs - 1]} HOURS`
  },
  {
    text: "HOW MANY PASSENGERS IN TOTAL?",
    answer: d => d.firstClass + d.businessClass + d.economy
  },
  {
    text: "LIST THE ENTIRE ROUTE (DEPARTURE TO FINAL).",
    answer: d => d.routeCities.join(" - ")
  },
  {
    text: "WHAT IS THE SECOND INTERMEDIATE STOP?",
    // For a 3-leg flight: stops are routeCities[1], routeCities[2].
    // The 'second' would be routeCities[2]. For 4-leg flight: routeCities[1], routeCities[2], routeCities[3].
    // The 'second' is still routeCities[2] if it exists:
    answer: d => (d.numLegs >= 3 ? d.routeCities[2] : "NONE")
  },
  {
    text: "WHAT IS THE APPROXIMATE FLIGHT TIME OF THE SECOND LEG?",
    answer: d => (d.numLegs >= 2 ? `${d.times[1]} HOURS` : "N/A")
  }
];

// Shuffle array in place
function shuffle(arr) {
  for (let i=arr.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

// Pick N distinct questions from questionPool
function pickQuestions(data, count=10) {
  const poolCopy = [...questionPool];
  shuffle(poolCopy);
  const selected = poolCopy.slice(0,count);
  // Return them with the resolved answer
  const questions = selected.map((q, idx) => ({
    number: idx+1,
    text: q.text,
    answer: q.answer(data)
  }));
  return questions;
}

function buildQuestionsHTML(questions) {
  let html = `<h2>QUESTIONS OF THE MEMORY PART</h2><ol>`;
  questions.forEach(q => {
    html += `<li>${q.text}</li>`;
  });
  html += `</ol>`;
  return html;
}

function buildAnswersHTML(questions) {
  let html = `<h2>ANSWERS</h2><ol>`;
  questions.forEach(q => {
    html += `<li>${q.answer}</li>`;
  });
  html += `</ol>`;
  return html;
}

/* TIMER & PAGE BEHAVIOR */
let timeLeft = 180;
let timerInterval = null;
let timerRunning = false;

function updateTimerDisplay() {
  const min = Math.floor(timeLeft / 60);
  const sec = timeLeft % 60;
  const minStr = min.toString().padStart(2, "0");
  const secStr = sec.toString().padStart(2, "0");
  $("#timerDisplay").text(`${minStr}:${secStr}`);
}

function startTimer() {
  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    if (timeLeft <= 0) {
      stopTimer();
      timeLeft = 0;
      updateTimerDisplay();
    }
  }, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
  }
  timerInterval = null;
}

function toggleStartStopTimer() {
  if (!timerRunning) {
    // Start
    timerRunning = true;
    $("#toggleStartStopBtn").text("STOP TIMER");
    // If time is 0 or 180, reset
    if (timeLeft === 0 || timeLeft === 180) {
      timeLeft = 180;
      updateTimerDisplay();
    }
    startTimer();
  } else {
    // Stop
    timerRunning = false;
    $("#toggleStartStopBtn").text("START TIMER");
    stopTimer();
  }
}

function showSection(sectionId) {
  $(".page-section").removeClass("active-section");
  $(`#${sectionId}`).addClass("active-section");
}

$(document).ready(function(){
  let currentQuestions = [];

  function generateAll() {
    const data = generateTestData();
    // Build passage
    $("#passageSection").html(buildPassage(data));
    // Build Q&A from random question selection
    currentQuestions = pickQuestions(data, 10);
    $("#questionsSection").html(buildQuestionsHTML(currentQuestions));
    $("#answersSection").html(buildAnswersHTML(currentQuestions));
  }

  // Initial generation
  generateAll();

  // Button actions
  $("#showPassageBtn").click(() => showSection("passageSection"));
  $("#showQuestionsBtn").click(() => showSection("questionsSection"));
  $("#showAnswersBtn").click(() => showSection("answersSection"));

  $("#regenerateBtn").click(() => generateAll());

  $("#toggleTimerBtn").click(() => $(".timer-container").toggle());

  $("#toggleStartStopBtn").click(() => toggleStartStopTimer());

  // Initialize timer display
  updateTimerDisplay();
});
</script>

</body>
</html>
